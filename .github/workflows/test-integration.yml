name: "Test integrations"
on: pull_request

jobs:
  danger_blank_test:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: "14"

      - run: |
          yarn install
          yarn build
          mkdir danger_blank_test
          cd danger_blank_test
          yarn init --yes
          yarn add file:..
          echo "warn('I warned you')" > dangerfile.js
          echo "Testing a blank Dangerfile on an empty project"
          DEBUG="*" yarn danger run --text-only
          cd ..
          rm -rf danger_blank_test
        name: "Make danger_blank_test"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  create_react_app:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: "16"

      - run: |
          yarn install
          yarn build
          npm install -g create-react-app
          create-react-app danger_babel_test
          cd danger_babel_test
          yarn add file:..
          echo "warn('Expect 2 warnings'); const a = async () => {warn('the other');}; schedule(a)" > dangerfile.js
          echo "Testing a blank Dangerfile on a babel CRA project"
          DEBUG="*" yarn danger ci --text-only
          cd ..
          rm -rf danger_babel_test
        name: "Make a small babel app"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
